# Epic 3 Retrospective: IELTS Exercise Builder & Content

**Date:** 2026-02-10
**Facilitator:** Bob (SM)
**Epic:** Epic 3 — IELTS Exercise Builder & Content (16 stories: 3.1–3.16)
**Previous Retro:** Epic 2 Retro (2026-02-06)

---

## Stories Reviewed

| Story | Title | Agent Model | Backend Tests | Frontend Tests | Review Issues Fixed |
|-------|-------|-------------|---------------|----------------|---------------------|
| 3.1 | Exercise Builder Core & Passage Management | Claude Opus 4.6 | 276 | 205 | — |
| 3.2 | Reading Question Types Basic (R1-R8) | Claude Opus 4.6 | 321 | 245 | 8 |
| 3.3 | Reading Question Types Matching (R9-R12) | Claude Opus 4.6 | 321 | 268 | 7 |
| 3.4 | Reading Question Types Advanced (R13-R14) | Claude Opus 4.6 | 321 | 301 | 8 |
| 3.5 | Answer Key Management | Claude Opus 4.6 | 313 | 313 | — |
| 3.6 | Listening Exercise Builder | Claude Opus 4.6 | 373 | 327 | 9 |
| 3.7 | Listening Question Types (L1-L6) | Claude Opus 4.6 | 373 | 343 | 5 |
| 3.8 | Writing Task Builder (W1-W3) | Claude Opus 4.6 | 387 | 356 | Multiple rounds |
| 3.9 | Speaking Exercise Builder (S1-S3) | Claude Opus 4.6 | 391 | 364 | 8 |
| 3.10 | Timer & Test Conditions | Claude Opus 4.6 | 402 | 394 | 10 |
| 3.11 | Exercise Tagging & Organization | Claude Opus 4.6 | 425 | 421 | 10 |
| 3.12 | AI Content Generation (Reading) | Claude Opus 4.6 | 446 | 440 | 10 |
| 3.13 | Mock Test Assembly | Claude Opus 4.6 | 510 | 469 | 10 (1 CRITICAL) |
| 3.14 | Exercise Library Management | Claude Opus 4.6 | 528 | 484 | 6 |
| 3.15 | Exercise Assignment Management | Claude Opus 4.6 | 557 | 500 | 10 |
| 3.16 | Student Assignment Dashboard | Claude Opus 4.6 | 569 | 524 | 8 |

**Model discipline:** All 16 stories built with Claude Opus 4.6. Zero Gemini usage for implementation.

---

## What Went Well

1. **All-Claude-Opus model discipline** — Measurable quality improvement over Epics 1-2. Review findings dropped from CRITICAL/HIGH (Gemini stories) to MEDIUM/LOW optimization-level issues. Codebase feels cohesive across all 16 stories. **Team decision: keep this practice.**
2. **16/16 stories delivered (100%)** — Largest epic by far (vs 11 in Epic 1, 6 in Epic 2). All 26 IELTS question types implemented: Reading R1-R14, Listening L1-L6, Writing W1-W3, Speaking S1-S3.
3. **Component reuse architecture** — Story 3.7 (Listening Question Types) mapped all 6 listening types to existing reading editors with zero new backend code. Factory pattern from 3.2 saved effort across 7+ subsequent stories.
4. **Frontend test discipline** — Consistent across all 16 stories. 524 frontend tests by story 3.16. Major improvement from Epic 2 where frontend tests were deferred every story.
5. **Test suite growth** — Backend: 276 → 569 (+106%). Frontend: 205 → 524 (+156%). Total: 481 → 1,093 (+127%).
6. **Code review consistency** — All 16 stories reviewed adversarially. ~128 issues found and fixed across the epic.
7. **Architecture patterns held** — Route-Controller-Service layering, getTenantedClient multi-tenancy, factory pattern for question types all consistently applied.
8. **E2E tests for Epics 1-2 exist** — 11 spec files in `apps/e2e/tests/` covering auth, users, navigation, logistics. Previously unrecorded.

## What Didn't Go Well

1. **Recurring code review findings** — Same categories flagged repeatedly: onBlur handler missing (~10 stories), missing edge-case tests (~12 stories), type safety gaps (~8 stories), dead code/unused imports (~6 stories). Prevention mechanisms needed.
2. **Deferred items fall through cracks** — 4 items deferred across the epic with no tracking mechanism: Task 3 validation endpoint (3.2), matching answer utility (3.3), AC8 mock test display (3.16), low-priority review items. None revisited.
3. **Status tracking drift — getting worse** — Story 3.1 file still shows "in-progress" instead of "done". Epic 3 in sprint-status showed "in-progress" despite 16/16 done. Same problem from Epic 2 retro (A3) was not addressed and pattern spread.
4. **Three epics of undeployed code** — No staging, no production. 33 completed stories across three epics with zero deployment. No real user validation.
5. **Completed work not documented** — Gemini code audit (Epic 2 A1) was done but unrecorded. E2E tests for Epics 1-2 exist but unrecorded. Two retros ran with incorrect assessments as a result.
6. **Action item follow-through declining** — Epic 1→2: 5/11 done. Epic 2→3: 3/10 done. Trend is worsening.
7. **E2E tests not written for Epic 3** — Framework exists, Epics 1-2 have coverage, but zero E2E tests for the 16 exercise builder stories.
8. **a11y linting and error boundaries** — Third consecutive epic these have been carried forward without action.

## Key Patterns Identified

### Architectural Investment Compounding
- Factory pattern established in 3.2 for question type editors/previews was reused across 3.3, 3.4, 3.7, 3.8, 3.9
- Story 3.7 (Listening Question Types) required zero backend changes — pure frontend factory wiring
- Component reuse strategy turned 26 question types into a manageable, predictable implementation

### Code Review Effectiveness
- ~8 issues found per story average (range: 5-10)
- Common categories: onBlur violations, missing tests, type safety, dead code
- Story 3.13 had 1 CRITICAL finding (band score calculation)
- All findings fixed before stories marked done

### Recording Gap
- Two significant work items (Gemini audit, E2E tests) were completed but not recorded
- Led to incorrect retro assessments and phantom action items
- Root cause: no process for updating tracking when work is done outside story context

---

## Epic 2 Action Items Follow-Through

| # | Action Item | Priority | Status | Evidence |
|---|-------------|----------|--------|----------|
| A1 | Code audit: Gemini foundations | P0 | ✅ Done (unrecorded) | Audit completed per Ducdo. Not documented in story files or sprint-status. |
| A2 | Unify Prisma table naming (@@map) | P0 | ⏳ Partial | All new Epic 3 models follow convention. Legacy models from Epics 1-2 unconfirmed. |
| A3 | Fix story status mismatches | P0 | ❌ Not Done | Problem worsened — story 3.1 and epic-3 status also drifted. |
| A4 | Frontend component tests | P1 | ✅ Done | Epic 3 wrote frontend tests consistently — 524 tests by 3.16. |
| A5 | Deploy Epic 2 | P1 | ❌ Not Done | Three epics now undeployed. |
| A6 | E2E test foundation | P1 | ✅ Done (unrecorded) | 11 spec files exist in apps/e2e/tests/ covering Epics 1-2. |
| A7 | a11y linting (eslint-plugin-jsx-a11y) | P2 | ❌ Not Done | Third consecutive carry-forward. |
| A8 | Error boundary wrappers | P2 | ❌ Not Done | Third consecutive carry-forward. |
| A9 | Rich text editor evaluation | P2 | ⏳ Deferred | Not in Epic 3 scope. |
| A10 | Exercise data model design | P2 | ✅ Done | Fully realized in Story 3.1. |

**Score: 4/10 Done, 2/10 Partial, 4/10 Not Done**

---

## Epic 3.5 Preview: Deployment & Infrastructure

**Decision:** Ducdo directed creation of Epic 3.5 (Deployment & Infrastructure) to run before Epic 4. Deploys on **Railway** with hosted Postgres.

**Scope:**

1. CI/CD pipeline — enhance existing CI/CD with build, test, lint, E2E gates
2. Staging environment — Railway staging service, database, Firebase project separation
3. Production environment — hardened Railway setup, backups, monitoring
4. Database migration strategy — Prisma migrate workflow for deployed environments
5. Environment configuration — env vars, secrets management, per-environment Firebase
6. Domain & SSL — staging and production URLs
7. Deployment workflow — develop → staging → production promotion
8. a11y linting (eslint-plugin-jsx-a11y) — folded in, three-epic carry-forward resolved
9. Error boundary wrappers — folded in, three-epic carry-forward resolved
10. Epic 3 E2E tests — Playwright tests for exercise builder flows, run against staging

**Sequencing:** Epic 3 (done) → Epic 3.5 (deployment) → Epic 4 (student submission)

**Rationale:** Epic 4 introduces offline-first patterns that require a real deployed environment to test meaningfully. Staging also unblocks E2E testing, user validation, and incremental deployment.

---

## Epic 4 Preview: Student Submission & Offline-Proofing

- **3 stories** (4.1–4.3) — smallest epic after Epic 3's 16-story marathon
- Story 4.1: Mobile Submission Interface (responsive, touch-friendly, camera integration)
- Story 4.2: Local Auto-save & Persistent Storage (3-second background save)
- Story 4.3: Offline Safeguards & Sync (offline queue, auto-retry, confirmation after server receipt)

**Dependencies on Epic 3:**
- Exercise rendering components (question type editors from 3.2-3.9)
- Assignment model and student records (3.15-3.16)
- Student dashboard as entry point (3.16)
- Timer/test conditions system (3.10)

**Dependencies on Epic 3.5:**
- Staging environment for offline-first testing
- CI/CD with E2E gates

---

## Action Items

### P0 — Before Epic 3.5 Starts

| # | Action | Owner | Success Criteria |
|---|--------|-------|------------------|
| A1 | Codify recurring review findings into prevention | Dev (Charlie) | Custom lint rule or shared utility for onBlur; pre-review checklist for top 4 recurring categories |
| A2 | Create deferred items register | SM (Bob) | DEFERRED.md or sprint-status section capturing deferred items; 4 Epic 3 items recorded |
| A3 | Fix all status tracking drift | SM (Bob) | Story 3.1 → done, epic-3 → done in sprint-status, stories 2-1/2-6 verified. Sprint-status.yaml documented as single source of truth. |
| A4 | Document completed work retroactively | SM (Bob) | Epic 2 retro amended noting Gemini audit completed and E2E tests for Epics 1-2 exist |

### P1 — During Epic 3.5

| # | Action | Owner | Success Criteria |
|---|--------|-------|------------------|
| A5 | Establish E2E-per-epic gate | SM (Bob) + QA (Dana) | Process rule documented: each epic gets final E2E story; epic can't be marked done without it. CI gate once CI/CD is ready. |
| A6 | Resolve Prisma @@map legacy cleanup | Dev (Charlie) | All Prisma models confirmed to have @@map. Migration created if needed. |
| A7 | Triage 4 deferred items from Epic 3 | Dev | Each item: implemented, won't-fix with rationale, or moved to future story |

### Team Agreements

- **Model discipline:** All-Claude-Opus for implementation. Gemini acceptable only for AI content generation features.
- **Record what you do:** Work done against action items gets a one-line note in sprint-status or retro file. No more phantom completions.
- **Sprint-status is source of truth:** Story files contain implementation notes. Sprint-status.yaml tracks status. If they conflict, sprint-status wins.
- **E2E gate:** Each epic gets a final E2E story. Epic cannot be marked done until E2E story is complete.

---

## Readiness Assessment

| Dimension | Status | Notes |
|-----------|--------|-------|
| Story completion | ✅ DONE | 16/16 stories complete |
| Backend test coverage | ✅ GOOD | 569 tests, growing each story |
| Frontend test coverage | ✅ GOOD | 524 tests, consistent across all stories |
| E2E test coverage | ⚠️ GAP | Framework exists, Epics 1-2 covered, Epic 3 not yet |
| Architecture patterns | ✅ GOOD | Consistent Route-Controller-Service, factory patterns |
| Multi-tenancy | ✅ GOOD | getTenantedClient enforced across all stories |
| Model consistency | ✅ GOOD | All Claude Opus 4.6 |
| Deployment | ❌ NOT DONE | No staging or production. Railway planned for Epic 3.5. |
| Status tracking | ⚠️ DRIFT | Sprint-status and story files out of sync. Fix committed (A3). |
| Deferred items | ⚠️ GAP | 4 items untracked. Register committed (A2). |

**Overall: Epic 3 stories are COMPLETE. Deployment gap addressed by Epic 3.5 on Railway. Ready to proceed to Epic 3.5 planning.**

---

## Critical Path

```
Fix status drift (A3) + Create deferred register (A2)
        ↓
  Codify review prevention (A1)
        ↓
  Epic 3.5 Planning (Deployment & Infrastructure on Railway)
        ↓
  Epic 3.5 Execution (staging + prod + CI/CD + a11y + error boundaries + Epic 3 E2E)
        ↓
  Epic 4: Student Submission & Offline-Proofing
```

---

## Retrospective Metadata

- **Agent:** Claude Opus 4.6
- **Workflow:** `_bmad/bmm/workflows/4-implementation/retrospective`
- **Duration:** Interactive session
- **Participants:** Bob (SM), Alice (PO), Charlie (Senior Dev), Dana (QA), Elena (Junior Dev), Ducdo (Project Lead)
- **Key Decision:** Epic 3.5 (Deployment & Infrastructure) created to run before Epic 4
- **Infrastructure:** Railway (deployment) + hosted Postgres
